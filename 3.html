<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>PMS 批量排班助手</title>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <style>
    /* 全局重置 */
    body { margin: 0; padding: 0; font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Microsoft YaHei", Arial, sans-serif; height: 100vh; display: flex; background: #f0f2f5; }
    
    /* 侧边栏模拟 (图1左侧) */
    .sidebar { width: 220px; background-color: #001529; color: #fff; display: flex; flex-direction: column; flex-shrink: 0; }
    .logo { height: 50px; line-height: 50px; padding-left: 20px; font-size: 18px; font-weight: bold; background: #002140; color: #1890ff; }
    .menu-item { height: 40px; line-height: 40px; padding-left: 20px; cursor: pointer; color: #a6adb4; font-size: 14px; }
    .menu-item:hover { color: #fff; }
    .menu-item.active { background: #1890ff; color: #fff; }
    .menu-group { font-size: 12px; color: #666; padding: 10px 20px; margin-top: 10px; }

    /*用于内容区的容器 */
    .main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .header { height: 50px; background: #fff; box-shadow: 0 1px 4px rgba(0,21,41,.08); display: flex; align-items: center; justify-content: flex-end; padding: 0 20px; font-size: 12px; }
    
    /* 核心工作区 */
    .work-area { flex: 1; padding: 20px; overflow-y: auto; }
    
    /* 白色卡片容器 */
    .card-box { background: #fff; border-radius: 4px; box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1); padding: 20px; min-height: 600px; display: flex; flex-direction: column;}
    .card-header { font-size: 16px; font-weight: bold; border-bottom: 1px solid #EBEEF5; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;}

    /* 步骤条样式优化 */
    .custom-steps { margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto; }

    /* STEP 1 表单区域 */
    .step1-container { width: 500px; margin: 40px auto; }
    .info-tip { background: #f4f4f5; color: #909399; font-size: 12px; padding: 8px 15px; border-radius: 4px; margin-top: -10px; margin-bottom: 20px; border-left: 3px solid #dcdfe6; }

    /* STEP 2 分组表格区域 */
    .section-wrap { margin-bottom: 30px; border: 1px solid #ebeef5; border-radius: 4px; overflow: hidden; }
    .section-header { padding: 12px 15px; font-weight: bold; font-size: 14px; display: flex; justify-content: space-between; align-items: center;}
    .section-header.rest { background-color: #fef0f0; color: #F56C6C; border-bottom: 1px solid #fde2e2; }
    .section-header.duty { background-color: #f0f9eb; color: #67C23A; border-bottom: 1px solid #e1f3d8; }
    
    .section-desc { font-weight: normal; font-size: 12px; color: #999; margin-left: 10px; }

    /* 批量操作工具栏 (灰色虚线背景) */
    .batch-toolbar { padding: 15px; background: #fcfcfc; border-bottom: 1px dashed #ebeef5; display: flex; align-items: center; gap: 10px; }
    .toolbar-label { font-size: 13px; font-weight: bold; color: #606266; }

    /* 错误提示文字 (模拟图2右侧红字) */
    .error-tag { color: #F56C6C; font-size: 12px; display: flex; align-items: center; margin-top: 4px; }
    .error-tag i { margin-right: 4px; }
    
    .footer-btns { margin-top: auto; padding-top: 20px; border-top: 1px solid #ebeef5; text-align: right; }
  </style>
</head>
<body>

<div id="app" style="display: flex; width: 100%;">
  
  <!-- 左侧菜单 (视觉背景) -->
  <div class="sidebar">
    <div class="logo">PMS System</div>
    <div class="menu-group">搜索菜单</div>
    <div class="menu-item"><i class="el-icon-search"></i> 找货模块</div>
    <div class="menu-group">采购配置</div>
    <div class="menu-item"><i class="el-icon-s-operation"></i> 缺货通知</div>
    <div class="menu-item"><i class="el-icon-setting"></i> 找货配置</div>
    <div class="menu-item"><i class="el-icon-document"></i> 采购明细</div>
    <div class="menu-item active"><i class="el-icon-date"></i> 采购分配</div>
    <div class="menu-item"><i class="el-icon-suitcase"></i> 工作安排</div>
  </div>

  <!-- 主内容区 -->
  <div class="main-container">
    <div class="header">
      <span><i class="el-icon-user"></i> 王林芳 (管理员)</span>
    </div>

    <div class="work-area">
      <div class="card-box">
        <!-- 标题 -->
        <div class="card-header">
          <span><i class="el-icon-date"></i> 批量排班助手</span>
        </div>

        <!-- 步骤条 -->
        <el-steps :active="currentStep" finish-status="success" simple class="custom-steps">
          <el-step title="选择范围" icon="el-icon-user"></el-step>
          <el-step title="配置明细" icon="el-icon-edit-outline"></el-step>
        </el-steps>

        <!-- Step 1: 范围选择 -->
        <div v-show="currentStep === 1">
          <el-form class="step1-container" label-width="100px" size="medium">
            <el-form-item label="采购员">
              <el-select v-model="formStep1.users" multiple placeholder="请选择人员" style="width: 100%;">
                <el-option label="王小虎" value="1"></el-option>
                <el-option label="李小狼" value="2"></el-option>
                <el-option label="木之本樱" value="3"></el-option>
                <el-option label="大道寺知世" value="4"></el-option>
              </el-select>
            </el-form-item>

            <el-form-item label="日期范围">
              <el-date-picker
                v-model="formStep1.dateRange"
                type="daterange"
                range-separator="至"
                start-placeholder="开始日期"
                end-placeholder="结束日期"
                value-format="yyyy-MM-dd"
                style="width: 100%;">
              </el-date-picker>
            </el-form-item>

            <el-form-item label="值班状态">
              <el-radio-group v-model="formStep1.defaultType">
                <el-radio label="rest">休息</el-radio>
                <el-radio label="duty">值班</el-radio>
              </el-radio-group>
            </el-form-item>

            <!-- 模拟截图中的灰色提示条 -->
            <div class="info-tip" style="margin-left: 100px;" v-if="formStep1.users.length && formStep1.dateRange">
              <i class="el-icon-info"></i> 预计将生成 
              <b>{{ formStep1.users.length }}</b> 人 × 
              <b>{{ dayCount }}</b> 天 = 
              <b>{{ formStep1.users.length * dayCount }}</b> 条 排班记录。
            </div>
          </el-form>
        </div>

        <!-- Step 2: 详细配置 -->
        <div v-show="currentStep === 2">
          
          <!-- 模块一：休息 > 任务转出 (红色系) -->
          <div class="section-wrap" style="border-top: 2px solid #F56C6C;">
            <div class="section-header rest">
              <span><i class="el-icon-plane"></i> 休息 > 任务转出 <span class="section-desc">我请假休息，需指定原接管人处理我的任务</span></span>
            </div>
            
            <!-- 批量操作栏 -->
            <div class="batch-toolbar">
              <span class="toolbar-label">批量操作：</span>
              <el-select v-model="batchRest.manager" placeholder="统一设接管人" size="small" style="width: 180px;">
                 <el-option label="李小狼" value="2"></el-option>
                 <el-option label="木之本樱" value="3"></el-option>
              </el-select>
              <el-select v-model="batchRest.tasks" multiple collapse-tags placeholder="统一设转出任务" size="small" style="width: 220px;">
                 <el-option label="全部任务" value="all"></el-option>
                 <el-option label="找货任务" value="sku"></el-option>
                 <el-option label="询价任务" value="inquiry"></el-option>
              </el-select>
              <el-button type="primary" plain size="small" icon="el-icon-magic-stick" @click="applyBatchRest">一键复用</el-button>
              <span style="flex:1; text-align:right; font-size:12px; color:#909399;">选中 {{ selectionRest.length }} 行</span>
            </div>

            <el-table :data="restList" border size="small" @selection-change="handleRestSelect">
              <el-table-column type="selection" width="50"></el-table-column>
              <el-table-column label="日期" width="180" prop="date">
                 <template slot-scope="scope">
                    {{ scope.row.date }} <span style="font-size:12px;color:#999;">(周{{ getWeek(scope.row.date) }})</span>
                 </template>
              </el-table-column>
              <el-table-column label="被接管人 (休息者)" width="150" prop="userName">
                 <template slot-scope="scope">
                    <strong>{{ scope.row.userName }}</strong>
                 </template>
              </el-table-column>
              <el-table-column label="接管人" min-width="180">
                 <template slot-scope="scope">
                    <el-select v-model="scope.row.manager" placeholder="选择同事" size="small" style="width: 100%">
                       <el-option label="李小狼" value="2"></el-option>
                       <el-option label="木之本樱" value="3"></el-option>
                       <el-option label="大道寺知世" value="4"></el-option>
                    </el-select>
                 </template>
              </el-table-column>
              <el-table-column label="接管任务" min-width="220">
                 <template slot-scope="scope">
                    <el-select v-model="scope.row.tasks" multiple collapse-tags placeholder="选择任务" size="small" style="width: 100%">
                       <el-option label="全部任务" value="all"></el-option>
                       <el-option label="找货任务" value="sku"></el-option>
                    </el-select>
                 </template>
              </el-table-column>
              <el-table-column label="操作" width="80" align="center">
                 <template slot-scope="scope">
                    <el-button type="text" icon="el-icon-delete" style="color:#F56C6C;" @click="removeRow(restList, scope.$index)"></el-button>
                 </template>
              </el-table-column>
            </el-table>
            <div v-if="restList.length === 0" style="padding: 20px; text-align:Center; color:#909399; font-size:13px;">暂无数据</div>
          </div>


          <!-- 模块二：值班 > 接管任务 (绿色系) -->
          <div class="section-wrap" style="border-top: 2px solid #67C23A;">
            <div class="section-header duty">
              <span><i class="el-icon-user-solid"></i> 值班 > 接管任务 <span class="section-desc">我正常在岗，去接管其他同事的任务</span></span>
            </div>

            <!-- 批量操作栏 -->
            <div class="batch-toolbar">
              <span class="toolbar-label">批量操作：</span>
              <el-select v-model="batchDuty.target" placeholder="统一设被接管人" size="small" style="width: 180px;">
                 <el-option label="木之本樱" value="3"></el-option>
                 <el-option label="大道寺知世" value="4"></el-option>
              </el-select>
              <el-select v-model="batchDuty.tasks" multiple collapse-tags placeholder="统一设接管任务" size="small" style="width: 220px;">
                 <el-option label="全部任务" value="all"></el-option>
                 <el-option label="询价任务" value="inquiry"></el-option>
              </el-select>
              <el-button type="primary" plain size="small" icon="el-icon-magic-stick" @click="applyBatchDuty">一键复用</el-button>
              <span style="flex:1; text-align:right; font-size:12px; color:#909399;">选中 {{ selectionDuty.length }} 行</span>
            </div>

            <el-table :data="dutyList" border size="small" @selection-change="handleDutySelect">
              <el-table-column type="selection" width="50"></el-table-column>
              <el-table-column label="日期" width="180" prop="date">
                 <template slot-scope="scope">
                    {{ scope.row.date }} <span style="font-size:12px;color:#999;">(周{{ getWeek(scope.row.date) }})</span>
                 </template>
              </el-table-column>
              <el-table-column label="接管人 (值班者)" width="150" prop="userName">
                 <template slot-scope="scope">
                    <strong>{{ scope.row.userName }}</strong>
                 </template>
              </el-table-column>
              <el-table-column label="被接管人" min-width="180">
                 <template slot-scope="scope">
                    <el-select v-model="scope.row.target" placeholder="选择同事" size="small" style="width: 100%">
                       <el-option label="木之本樱" value="3"></el-option>
                       <el-option label="大道寺知世" value="4"></el-option>
                    </el-select>
                 </template>
              </el-table-column>
              <el-table-column label="接管任务" min-width="220">
                 <template slot-scope="scope">
                    <el-select v-model="scope.row.tasks" multiple collapse-tags placeholder="选择任务" size="small" style="width: 100%">
                       <el-option label="全部任务" value="all"></el-option>
                       <el-option label="询价任务" value="inquiry"></el-option>
                    </el-select>
                 </template>
              </el-table-column>
              <el-table-column label="操作" width="120" align="center">
                 <template slot-scope="scope">
                    <el-button type="text" icon="el-icon-delete" style="color:#F56C6C;" @click="removeRow(dutyList, scope.$index)"></el-button>
                    <!-- 模拟截图中的红字错误提示 -->
                    <div v-if="scope.row.hasError" class="error-tag">
                      <i class="el-icon-warning-outline"></i> 任务已存在
                    </div>
                 </template>
              </el-table-column>
            </el-table>
            <div v-if="dutyList.length === 0" style="padding: 20px; text-align:Center; color:#909399; font-size:13px;">暂无数据</div>
          </div>

        </div>

        <!-- 底部按钮 -->
        <div class="footer-btns">
           <el-button @click="prevStep" v-if="currentStep === 2">上一步</el-button>
           <el-button @click="close">取 消</el-button>
           <el-button type="primary" @click="nextStep" v-if="currentStep === 1">下一步</el-button>
           <el-button type="primary" @click="submit" v-if="currentStep === 2">确 定</el-button>
        </div>

      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script>
  const USERS = { '1': '王小虎', '2': '李小狼', '3': '木之本樱', '4': '大道寺知世' };

  new Vue({
    el: '#app',
    data() {
      return {
        currentStep: 1,
        // 第一步表单
        formStep1: {
          users: ['1', '2'], 
          dateRange: ['2025-12-25', '2025-12-26'],
          defaultType: 'duty' 
        },
        
        // 两个列表数据
        restList: [],
        dutyList: [],
        
        // 选中项
        selectionRest: [],
        selectionDuty: [],

        // 批量操作模型
        batchRest: { manager: '', tasks: [] },
        batchDuty: { target: '', tasks: [] }
      }
    },
    computed: {
      dayCount() {
        if (!this.formStep1.dateRange) return 0;
        const start = new Date(this.formStep1.dateRange[0]);
        const end = new Date(this.formStep1.dateRange[1]);
        return Math.floor((end - start) / (1000 * 3600 * 24)) + 1;
      }
    },
    methods: {
      // 核心：生成数据
      nextStep() {
        if (!this.formStep1.users.length || !this.formStep1.dateRange) {
           this.$message.warning("请完善选择");
           return;
        }

        this.restList = [];
        this.dutyList = [];
        
        const [startStr, endStr] = this.formStep1.dateRange;
        const dates = this.getDates(startStr, endStr);

        this.formStep1.users.forEach(uid => {
          dates.forEach(date => {
             const baseRow = {
               date: date,
               userId: uid,
               userName: USERS[uid],
               tasks: []
             };

             // 模拟：给"王小虎(1)"在"25号"制造一个错误冲突，并强制为值班
             if(uid === '1' && date === '2025-12-25') {
                 this.dutyList.push({ ...baseRow, target: '2', hasError: true }); // 模拟红字
             } 
             // 模拟：给"李小狼(2)"默认为休息
             else if (uid === '2') {
                 this.restList.push({ ...baseRow, manager: '' });
             } 
             // 其他按默认类型
             else {
               if (this.formStep1.defaultType === 'rest') {
                 this.restList.push({ ...baseRow, manager: '' });
               } else {
                 this.dutyList.push({ ...baseRow, target: '' });
               }
             }
          });
        });

        this.currentStep = 2;
      },
      prevStep() {
        this.currentStep = 1;
      },
      close() {
        this.$message('关闭弹窗');
      },
      submit() {
        this.$confirm('确定保存当前排班设置吗？', '提示', { type: 'warning' }).then(() => {
           this.$message.success('保存成功');
           console.log('Rest:', this.restList);
           console.log('Duty:', this.dutyList);
        });
      },

      // 批量：休息
      applyBatchRest() {
        if (!this.selectionRest.length) return this.$message.warning("请先勾选下方行");
        this.selectionRest.forEach(row => {
          if(this.batchRest.manager) row.manager = this.batchRest.manager;
          if(this.batchRest.tasks.length) row.tasks = [...this.batchRest.tasks];
        });
        this.$message.success(`已应用到 ${this.selectionRest.length} 行`);
      },

      // 批量：值班
      applyBatchDuty() {
        if (!this.selectionDuty.length) return this.$message.warning("请先勾选下方行");
        this.selectionDuty.forEach(row => {
          if(this.batchDuty.target) row.target = this.batchDuty.target;
          if(this.batchDuty.tasks.length) row.tasks = [...this.batchDuty.tasks];
        });
        this.$message.success(`已应用到 ${this.selectionDuty.length} 行`);
      },

      handleRestSelect(val) { this.selectionRest = val; },
      handleDutySelect(val) { this.selectionDuty = val; },

      removeRow(list, index) {
        list.splice(index, 1);
      },

      // 工具：日期
      getDates(start, end) {
        let arr = [];
        let dt = new Date(start);
        let endDt = new Date(end);
        while(dt <= endDt) {
           let m = (dt.getMonth()+1).toString().padStart(2,'0');
           let d = dt.getDate().toString().padStart(2,'0');
           arr.push(`${dt.getFullYear()}-${m}-${d}`);
           dt.setDate(dt.getDate()+1);
        }
        return arr;
      },
      getWeek(dateStr) {
        const weeks = ['日','一','二','三','四','五','六'];
        return weeks[new Date(dateStr).getDay()];
      }
    }
  })
</script>
</body>
</html>